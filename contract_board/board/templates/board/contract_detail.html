{% extends 'base.html' %} 
{% block content %}
<section class="container">
  <div class="text-center" class = "contract" id="{{object.id}}">
    <h1>View Contract</h1>
    {% if user.type == 'CONTRACTEE' and contract.contractee == user  %}
    <div class = "right">
      <a 
        href ="#"
        class = "contrast"
        role = "button"
        data-target="modal-example"
        onClick="toggleModal(event)">
        Delete Contract
      </a>
    </div>
 

   
    <dialog id="modal-example">
      <article>
        <a href="#close"
          aria-label="Close"
          class="close"
          data-target="modal-example"
          onClick="toggleModal(event)">
        </a>
        <h3>Confirm your action!</h3>
        <p>
          Are you sure you want to delete contract?
        </p>
        <footer>
          <a href="#cancel"
            role="button"
            class="contrast"
            data-target="modal-example"
            onClick="toggleModal(event)">
            Cancel
          </a>
          <a href="#confirm"
            role="button"
            data-target="modal-example"
            onClick="deleteContract()">
            Confirm
          </a>
        </footer>
      </article>
    </dialog>
    

    {% endif %}
  </div>
  <article>
    <h2>{{ object.contract_title }}</h2>
    <div class="h-stack">
      <div><b>Agency Name:</b></div>
      <div><b>Email:</b></div>
      <div><b>Expires:</b></div>
      <div><b>Lowest Bid:</b></div>
      <div><b>Description:</b></div>
    </div>
    <div class="h-stack">
      <div>{{ object.contractee.agency_name }}</div>
      <div>{{ object.contractee.email }}</div>
      <div>{{ object.bidding_end_date }}</div>
            <div>
        {% if object.lowest_bid == 0 %} 
        None 
        {% else %} 
          ${{ object.lowest_bid }}
        {% endif %}
      </div>
      <div>{{ object.job_description }}</div>
    </div>
  </article>
</section>
<section class="beige-bg pad-section">
  <div class="container">
    <nav>
      <ul>
        <li><h4>Current Bids</h4></li>
      </ul>
      {% if user.type == 'CONTRACTOR' %}
        <ul>
          <li><a href="{% url 'create_bid' object.pk %}" role="button">Place a New Bid</a></li>
        </ul>
      {% endif %} 
    </nav>
    {% if object.bids|length == 0 %}
      <div>There are no bids</div>
    {% else %}
      <div class="card-grid">
        {% for bid in object.bids %}
          <article class="remove-margin">
            <h5>{{ bid.contractor.agency_name }}</h5>
            <div><b>Bid</b></div>
            <p>${{ bid.amount }}</p>
            <div><b>Email</b></div>
            <p>{{ bid.contractor.email }}</p>
            <div><b>Date Placed</b></div>
            <p>{{ bid.date_placed }}</p>
          </article>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</section>
<script>
  const isOpenClass = "modal-is-open";
const openingClass = "modal-is-opening";
const closingClass = "modal-is-closing";
const animationDuration = 400; // ms
let visibleModal = null;
let contractID = null; //for tracking contract ID

contractID = console.log(this.herf.substring(this.herf.lastIndexOf('/') + 1 ))
const deleteContract = () => {
  window.location.herf = 'contract/delete/<int:pk>' + contractID;
}

// Toggle modal
const toggleModal = (event) => {
event.preventDefault();
const modal = document.getElementById(event.currentTarget.getAttribute("data-target"));
typeof modal != "undefined" && modal != null && isModalOpen(modal)
? closeModal(modal)
: openModal(modal);
};

// Is modal open
const isModalOpen = (modal) => {
return modal.hasAttribute("open") && modal.getAttribute("open") != "false" ? true : false;
};

// Open modal
const openModal = (modal) => {
if (isScrollbarVisible()) {
document.documentElement.style.setProperty("--scrollbar-width", `${getScrollbarWidth()}px`);
}
document.documentElement.classList.add(isOpenClass, openingClass);
setTimeout(() => {
visibleModal = modal;
document.documentElement.classList.remove(openingClass);
}, animationDuration);
modal.setAttribute("open", true);
};

// Close modal
const closeModal = (modal) => {
visibleModal = null;
document.documentElement.classList.add(closingClass);
setTimeout(() => {
document.documentElement.classList.remove(closingClass, isOpenClass);
document.documentElement.style.removeProperty("--scrollbar-width");
modal.removeAttribute("open");
}, animationDuration);
};

// Close with a click outside
document.addEventListener("click", (event) => {
if (visibleModal != null) {
const modalContent = visibleModal.querySelector("article");
const isClickInside = modalContent.contains(event.target);
!isClickInside && closeModal(visibleModal);
}
});

// Close with Esc key
document.addEventListener("keydown", (event) => {
if (event.key === "Escape" && visibleModal != null) {
closeModal(visibleModal);
}
});

// Get scrollbar width
const getScrollbarWidth = () => {
// Creating invisible container
const outer = document.createElement("div");
outer.style.visibility = "hidden";
outer.style.overflow = "scroll"; // forcing scrollbar to appear
outer.style.msOverflowStyle = "scrollbar"; // needed for WinJS apps
document.body.appendChild(outer);

// Creating inner element and placing it in the container
const inner = document.createElement("div");
outer.appendChild(inner);

// Calculating difference between container's full width and the child width
const scrollbarWidth = outer.offsetWidth - inner.offsetWidth;

// Removing temporary elements from the DOM
outer.parentNode.removeChild(outer);

return scrollbarWidth;
};

// Is scrollbar visible
const isScrollbarVisible = () => {
return document.body.scrollHeight > screen.height;
};
  
</script>
{% endblock %}

